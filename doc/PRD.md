# 全能扫描系统 - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品名称
全能扫描系统

### 1.2 产品定位
面向仓库/物流分拣场景的智能化箱号扫描分区系统。系统由PC端Web服务和Android手持终端应用组成，PC端负责数据管理和连接配置，手持终端负责扫描箱号条码、显示分区信息、语音播报并上传扫描记录。

### 1.3 使用场景
1. 管理员在PC端启动系统，上传Excel文件导入箱号与分区的对应数据
2. PC端显示连接二维码，手持终端扫描二维码自动连接到PC端服务
3. 仓库工人使用手持终端内置扫描头扫描箱号条码
4. 手持终端自动查询箱号对应的分区信息，大字显示分区号，同时中文语音播报
5. 手持终端将扫描记录（箱号、扫描时间）上传到PC端
6. 工人根据分区信息将货物放到对应区域
7. 管理员可随时在PC端查看扫描进度、导出扫描结果

### 1.4 目标用户
- **管理员**：在PC端操作，负责启动系统、上传Excel数据、管理数据集、查看扫描进度、导出扫描结果
- **仓库工人**：在手持终端操作，负责扫描二维码连接、扫描箱号、查看分区信息

### 1.5 核心价值
- 替代纸质分区对照表，消除人工查找错误
- 语音播报解放双眼，工人无需低头看屏幕
- 二维码一键连接，无需手动输入IP地址
- 实时进度追踪，管理员随时掌握分拣进度
- 原生安卓应用体验流畅，响应快速
- 一键部署，无需专业IT支持

---

## 2. 硬件与网络环境

### 2.1 手持终端设备
- **型号**：Android手持终端（支持扫描功能）
- **操作系统**：Android 5.0+
- **使用姿态**：竖屏手持
- **扫描方式**：内置扫描头，扫描结果通过原生应用处理
- **应用类型**：Android原生应用（APK安装包）

### 2.2 PC端设备
- **类型**：普通Windows电脑（Windows 7+）
- **启动方式**：
  - 方式1：双击 `启动系统.bat` 批处理脚本（需要Python 3.8+环境）
  - 方式2：双击 `全能扫描系统.exe` 可执行文件（无需Python环境）
- **自动功能**：启动后自动打开浏览器访问管理页面
- **角色**：运行Flask Web服务器，提供数据管理和API服务

### 2.3 网络环境
- **网络**：公司内网WiFi
- **要求**：Q9设备与服务端电脑在同一局域网内
- **访问方式**：Q9浏览器通过 `http://服务器IP:5000` 访问
- **无外网依赖**：系统所有资源（前端、语音）均在本地，不依赖外网CDN或云服务

---

## 3. 用户模型

### 3.1 使用模式
- PC端：单用户管理，无需登录/注册/权限管理
- 手持终端：多设备可同时连接到PC端，各自独立扫描
- 无需用户身份识别
- 所有访问者具有完整操作权限

### 3.2 用户技术水平
- 基础水平，仅会基本电脑操作
- 部署过程需极简化（一键安装、一键启动）
- 手持终端应用界面简洁，操作直观

---

## 4. 功能需求

### 4.1 PC端功能

#### 4.1.1 系统启动
- 启动后自动显示服务器IP地址和端口
- 显示连接二维码（包含服务器地址信息）
- 自动在默认浏览器中打开管理页面

#### 4.1.2 Excel数据导入

| 属性 | 规格 |
|------|------|
| 文件格式 | .xlsx（仅支持此格式） |
| Sheet结构 | 单Sheet |
| 表头 | 第一行为表头行（读取时跳过） |
| 列顺序 | 固定顺序：第1列=箱号，第2列=门店地址，第3列=分区 |
| 箱号格式 | 字母与数字混合（如 `ABC123`、`X7890Y`） |
| 箱号唯一性 | 同一文件内箱号唯一，不存在重复 |
| 分区格式 | "数字-数字"格式（如 `1-2`、`3-5`、`12-1`） |
| 用户自定义名称 | 上传时用户输入一个自定义名称标识该数据集 |
| 多文件共存 | 支持导入多个Excel文件，各自独立管理 |

#### 4.1.3 数据集管理

- **列表展示**：显示所有已导入数据集，包含名称、原始文件名、总箱号数、已扫描数、导入时间
- **删除**：支持手动删除数据集，删除前弹出确认对话框，确认后删除该数据集及其所有箱号数据和扫描记录
- **选择扫描**：点击数据集设置为当前扫描数据集
- **导出**：将数据集导出为.xlsx文件，包含原始数据（箱号、门店地址、分区）+ 扫描状态（已扫描/未扫描）+ 扫描时间

#### 4.1.4 扫描进度监控

- 实时显示当前数据集的扫描进度
- 显示已扫描数、总数、百分比
- 显示在线手持终端数量
- 显示最近扫描记录列表

### 4.2 手持终端功能

#### 4.2.1 连接管理

- **扫码连接**：扫描PC端显示的二维码，自动连接到服务器
- **连接状态显示**：显示当前连接状态（已连接/未连接/连接中）
- **断线重连**：网络中断后自动尝试重连
- **服务器地址配置**：支持手动输入服务器地址（备用方案）

#### 4.2.2 扫描功能

**扫描模式：**
- 一次只扫描一个数据集（在PC端选择当前数据集）
- 手持终端启动后自动获取当前数据集信息

**输入方式：**
- 页面加载后，扫描输入框**自动获取焦点**
- 手持终端扫描头扫描条码后，结果直接传入应用
- 扫描完成后**自动清空输入框并重新聚焦**，准备下一次扫描
- 全程无需手动点击任何按钮

**查询结果显示：**

**正常扫描（首次扫描到已存在的箱号）：**
- 分区号：超大字体（>=80px），统一醒目颜色（亮绿色），深色背景
- 门店地址：中等字体辅助显示
- 状态：无特殊提示
- 语音：中文播报分区号
- 上传：自动上传扫描记录到服务器

**重复扫描（再次扫描已扫过的箱号）：**
- 分区号：超大字体（>=80px），黄色，深色背景
- 门店地址：中等字体辅助显示
- 状态：显示"已扫描"提示标签
- 语音：仍然播报分区号（与正常扫描相同）
- 说明：重复扫描**不增加**已扫描计数
- 上传：仍然上传扫描记录（服务器端识别为重复）

**未找到（箱号不存在于当前数据集）：**
- 无分区信息显示
- 背景变为红色
- 显示"未找到该箱号"警告文字
- 播放警告音效（非语音）
- 不影响扫描计数
- 上传：不上传记录

#### 4.2.3 语音播报规则
- 使用Android原生TTS（Text-to-Speech）引擎
- 语音语言：中文（zh-CN）
- 播报内容：将分区号逐字读出
- 转换规则：数字映射为中文，连字符忽略
  - `1-2` → "分区 一 二"
  - `3-5` → "分区 三 五"
  - `12-1` → "分区 一 二 一"
- 语速：适中

#### 4.2.4 进度显示
- 格式："已扫 X / Y（XX%）"
- X = 已扫描的不重复箱号数
- Y = 当前数据集总箱号数
- 百分比 = X/Y * 100，取整数
- 附带可视化进度条
- 扫描完成（100%）时仅通过进度显示体现，无额外弹窗或提示

#### 4.2.5 历史记录
- 在扫描页面底部显示最近5条扫描记录
- 每条记录包含：箱号、分区号、扫描时间
- 按时间倒序排列（最新在最上）
- 小字紧凑排列，不抢占主显示区域

### 4.3 数据导出

- 导出格式：.xlsx
- 导出内容：
  - 第1列：箱号
  - 第2列：门店地址
  - 第3列：分区
  - 第4列：扫描状态（"已扫描" / "未扫描"）
  - 第5列：扫描时间（已扫描的箱号显示具体时间，未扫描的留空）
- 在PC端浏览器触发下载

### 4.4 数据持久化

- 所有扫描记录实时写入SQLite数据库
- 手持终端断开连接后数据不丢失
- 重新连接后，自动恢复扫描进度（已扫描数、进度条）
- 服务端重启后数据仍保留（SQLite文件持久化）

---

## 5. 非功能需求

### 5.1 性能要求
- 扫描查询响应时间：< 500ms（原生应用，比浏览器更快）
- 页面加载时间：< 2秒（内网环境，无外部依赖）
- 支持单个Excel文件数据量：至少10,000条箱号记录
- 支持多手持终端同时连接：至少5台

### 5.2 可靠性
- 扫描数据实时持久化，断电/断网不丢失已扫描数据
- SQLite数据库文件级存储，无需额外数据库服务
- 手持终端断线后自动重连，数据暂存本地，连接后自动上传

### 5.3 易用性
- 一键安装依赖（install.bat）
- 一键启动服务（启动系统.bat）
- 支持打包为独立可执行文件，无需Python环境
- 启动时自动显示服务器IP地址和连接二维码
- 启动后自动打开浏览器访问管理页面
- 手持终端扫描二维码一键连接，无需手动输入
- 扫描页面全自动化操作（自动聚焦、自动提交、自动清空）

### 5.4 兼容性
- PC端：Windows 7+ + Python 3.8+（批处理方式）或 Windows 7+（可执行文件方式）
- 手持终端：Android 5.0+，支持扫描功能
- PC端浏览器：Chrome/Edge/Firefox
- 手持终端应用：Android原生应用

---

## 6. 约束与假设

### 6.1 约束
- 仅支持.xlsx格式Excel文件
- Excel列顺序必须固定为：箱号、门店地址、分区
- 同一数据集内箱号不重复
- 系统设计为多手持终端同时使用，服务器端需处理并发
- 不支持在线编辑箱号数据，修改需重新上传
- 手持终端应用需要安装APK文件

### 6.2 假设
- 手持终端的扫描头能正确扫描条码并将结果传递给应用
- 手持终端的Android系统支持TTS（Text-to-Speech）引擎
- 公司内网WiFi信号覆盖仓库工作区域
- PC端Windows电脑在工作期间持续开机运行
- 手持终端与PC端在同一局域网内

---

## 7. 新架构说明

### 7.1 架构变化
- **旧架构**：PC端Web服务 + 浏览器访问（Q9设备通过浏览器访问）
- **新架构**：PC端Web服务 + Android原生应用（手持终端安装APK）

### 7.2 优势
- 原生应用响应更快，用户体验更流畅
- 更好的硬件集成（扫描头、TTS、震动等）
- 离线缓存能力，网络中断不影响扫描
- 二维码连接，简化配置流程
- 更稳定的连接管理

### 7.3 二维码连接流程
1. PC端启动服务，生成包含服务器地址的二维码
2. 手持终端打开应用，点击"扫码连接"
3. 扫描二维码，自动解析服务器地址
4. 应用自动连接到服务器
5. 连接成功后显示当前数据集信息
